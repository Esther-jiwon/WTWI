<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="freeboardMapper">
	
	<!-- 카테고리 -->
	<resultMap type="FreeCategory" id="category_rm">
		<id property="freeCategoryNo" column="FREE_CATEGORY_NO"/>
		<result property="freeCategoryName" column="FREE_CATEGORY_NM"/>
	</resultMap>
	
	<!-- 페이지네이션 -->
	<resultMap type="FreePagination" id="pg_rm">
		<result property="listCount" column="CNT"/>
	</resultMap>
	
	<!-- 첨부 이미지 -->
	<resultMap type="FreeImage" id="image_rm">
		<id property="fileNo" column="FILE_NO"/>
		<result property="fileName" column="FILE_NM"/>
		<result property="filePath" column="FILE_PATH"/>
		<result property="freeNo" column="FREE_NO"/>
	</resultMap>

	<!-- 게시글 -->
	<resultMap type="FreeBoard" id="free_rm">
		<id property="freeNo" column="FREE_NO"/>
		
		<result property="freeCategoryName" column="FREE_CATEGORY_NM"/>
		<result property="freeTitle" column="FREE_TITLE"/>
		<result property="memberNick" column="MEMBER_NICK"/>
		<result property="freeCreateDate" column="FREE_CREATE_DT"/>
		<result property="freeReadCount" column="FREE_READ_COUNT"/>
		<result property="replyCount" column="REPLY_COUNT"/>
		<result property="likeCount" column="LIKE_COUNT"/>
		
		<!-- 게시글 첨부 이미지 정보 -->
		<collection property="atList" column="FREE_NO" javaType="java.util.ArrayList" ofType="Image" select="selectImage"/>
	</resultMap>
	
	<!-- 전체 게시글 수 조회(1) -->
	<select id="getListCount" resultMap="pg_rm">
		SELECT COUNT(*) CNT FROM FREE_LIST WHERE FREE_STATUS='Y' 
	</select>
	
	<!-- 게시글 목록 조회(2) -->
	<select id="selectBoardList" parameterType="_int" resultMap="free_rm">
		SELECT * FROM FREE_LIST
		WHERE FREE_STATUS='Y'
		ORDER BY FREE_NO DESC
	</select>
	
	<!-- 게시글 상세 조회(3-1) 및 첨부 이미지 정보 조회 -->
	<select id="selectBoard" parameterType="_int" resultMap="free_rm">
		SELECT * FROM FREE_DETAIL
		WHERE FREE_NO = #{freeNo}
		AND FREE_STATUS = 'Y'
	</select>
	<select id="selectImage" parameterType="_int" resultMap="image_rm">
		SELECT * FROM FREE_IMAGE
		WHERE FREE_NO = #{freeNo}
	</select>
	
	<!-- 게시글 조회수 증가(3-2) -->
	<update id="increaseReadCount" parameterType="_int">
		UPDATE FREE_BOARD SET
		FREE_READ_COUNT = FREE_READ_COUNT + 1
		WHERE FREE_NO = #{freeNo}
	</update>
	
	<!-- 카테고리 목록 조회(4) -->
	<select id="selectCategory" resultMap="category_rm">
		SELECT * FROM FREE_CATEGORY
	</select>
</mapper>
