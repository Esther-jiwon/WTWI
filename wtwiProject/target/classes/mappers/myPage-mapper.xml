<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="myPageMapper">
	<resultMap type="MyPagePagination" id="pg_rm">
		<result property="listCount" column="CNT" />
	</resultMap>


	<!-- 자유게시판 -->
	<resultMap type="FreeBoard" id="free_rm">
		<id property="freeNo" column="FREE_NO" />

		<result property="freeCategoryName" column="FREE_CATEGORY_NM" />
		<result property="freeTitle" column="FREE_TITLE" />
		<result property="memberNick" column="MEMBER_NICK" />
		<result property="freeReadCount" column="FREE_READ_COUNT" />
		<result property="freeCreateDate" column="FREE_CREATE_DT" />
		<result property="freeModifyDate" column="FREE_MODIFY_DT" />
		<result property="freeContent" column="FREE_CONTENT" />
		<result property="likeCount" column="LIKE_COUNT" />
		<result property="replyCount" column="REPLY_COUNT" />
	</resultMap>

	<!-- 문의게시판 -->
	<resultMap type="QnaBoard" id="qna_rm">
		<id property="qnaNo" column="QNA_NO" />

		<result property="qnaPno" column="QNA_PNO" />
		<result property="qnaTitle" column="QNA_TITLE" />
		<result property="qnaContent" column="QNA_CONTENT" />
		<result property="qnaReadCount" column="QNA_READ_COUNT" />
		<result property="qnaCreateDt" column="QNA_CREATE_DT" />
		<result property="qnaModifyDt" column="QNA_MODIFY_DT" />
		<result property="qnaStatus" column="QNA_STATUS" />
		<result property="qnaCategoryNo" column="QNA_CATEGORY_NO" />
		<result property="qnaCategoryNm" column="QNA_CATEGORY_NM" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="memberNick" column="MEMBER_NICK" />

	</resultMap>

	<!-- 1:1 문의내역 -->
	<resultMap type="Chat" id="chat_rm">
		<id property="chatNo" column="CHAT_NO" />

		<result property="chatContent" column="CHAT_CONTENT" />
		<result property="chatCreateDt" column="CHAT_CREATE_DT" />
		<result property="chatReadYn" column="CHAT_READ_YN" />
		<result property="chatRoomNo" column="CHAT_ROOM_NO" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="attractionNm" column="ATTRACTION_NM" />
	</resultMap>
	
	<!-- 신고내역 -->
	<resultMap type="Report" id="report_rm">
		<id property="reportNo" column="REPORT_NO" />

		<result property="reportTitle" column="REPORT_TITLE" />
		<result property="reportContent" column="REPORT_CONTENT" />
		<result property="reportCreateDt" column="REPORT_CREATE_DT" />
		<result property="reportStatus" column="REPORT_STATUS" />
		<result property="reportType" column="REPORT_TYPE" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="reportCategoryNo" column="REPORT_CATEGORY_NO" />
		<result property="reportCategoryNm" column="REPORT_CATEGORY_NM" />
	</resultMap>


	<!-- 자유게시판 -->
	<!-- 자유게시판 게시글 수 조회 -->
	<select id="getFreeListCount" parameterType="Member"
		resultMap="pg_rm">
		SELECT
		COUNT(*) CNT FROM FREE_LIST
		WHERE MEMBER_NO =
		#{memberNo}
		AND
		FREE_STATUS = 'Y'
	</select>
	<!-- 자유게시판 게시글 수 조회(검색) -->
	<select id="getSearchFreeListCount" parameterType="MyPageSearch"
		resultMap="pg_rm">
		SELECT COUNT(*) CNT FROM FREE_LIST
		WHERE MEMBER_NO = #{memberNo}
		AND
		FREE_STATUS = 'Y'
		<if test="sv != ''">
			AND
			<bind name="val" value="'%' + sv + '%'" />
			<!-- sk에 따라서 조건절을 선택함 -->
			<choose>
				<when test="sk == 'title'">
					FREE_TITLE LIKE #{val}
				</when>
				<when test="sk == 'content'">
					FREE_CONTENT LIKE #{val}
				</when>
			</choose>
			<if test="sc != 0">
				AND FREE_CATEGORY_NO = ${sc}
			</if>

		</if>
	</select>

	<!-- 자유게시판 게시글 목록 조회 -->
	<select id="selectFreeBoardList" parameterType="map"
		resultMap="free_rm">
		SELECT * FROM
		FREE_LIST
		WHERE FREE_STATUS = 'Y'
		AND MEMBER_NO =
		#{memberNo}
		ORDER BY 
		<if test="order != null">
			<choose>
				<when test="order == 'read'">
					FREE_READ_COUNT DESC,
				</when>
				<when test="order == 'like'">
					LIKE_COUNT DESC,
				</when>
			</choose>
		</if>
		FREE_NO DESC
	</select>
	<!-- 자유게시판 게시글 목록 조회(검색) -->
	<select id="selectSearchFreeBoardList"
		parameterType="MyPageSearch" resultMap="free_rm">
		SELECT * FROM
		FREE_LIST
		WHERE FREE_STATUS = 'Y'
		AND MEMBER_NO =
		#{memberNo}
		<if test="sv != ''">
			AND
			<bind name="val" value="'%' + sv + '%'" />
			<!-- sk에 따라서 조건절을 선택함 -->
			<choose>
				<when test="sk == 'title'">
					FREE_TITLE LIKE #{val}
				</when>
				<when test="sk == 'content'">
					FREE_CONTENT LIKE #{val}
				</when>
			</choose>
			<if test="sc != 0">
				AND FREE_CATEGORY_NO = ${sc}
			</if>

		</if>
		
		ORDER BY 
		<if test="order != null">
			<choose>
				<when test="order == 'read'">
					FREE_READ_COUNT DESC,
				</when>
				<when test="order == 'like'">
					LIKE_COUNT DESC,
				</when>
			</choose>
		</if>
		
		FREE_NO DESC
	</select>





	<!-- 문의게시판 -->
	<!-- 문의게시판 게시글 수 조회 -->
	<select id="getQnAListCount" parameterType="Member"
		resultMap="pg_rm">
		SELECT
		COUNT(*) CNT FROM QNA_LIST
		WHERE MEMBER_NO =
		#{memberNo}
		AND QNA_STATUS IN('Y', 'S')
	</select>
	<!-- 문의게시판 게시글 수 조회(검색) -->
	<select id="getSearchQnAListCount" parameterType="MyPageSearch"
		resultMap="pg_rm">
		SELECT COUNT(*) CNT FROM QNA_LIST
		WHERE MEMBER_NO = #{memberNo}
		AND
		QNA_STATUS IN('Y', 'S')
		<if test="sv != ''">
			AND
			<bind name="val" value="'%' + sv + '%'" />
			<!-- sk에 따라서 조건절을 선택함 -->
			<choose>
				<when test="sk == 'title'">
					QNA_TITLE LIKE #{val}
				</when>
				<when test="sk == 'content'">
					QNA_CONTENT LIKE #{val}
				</when>
			</choose>
			<if test="sc != 0">
				AND QNA_CATEGORY_NO = ${sc}
			</if>

		</if>
	</select>

	<!-- 문의게시판 게시글 목록 조회 -->
	<select id="selectQnABoardList" parameterType="Member"
		resultMap="qna_rm">
		SELECT * FROM
		QNA_LIST
		WHERE QNA_STATUS IN('Y', 'S')
		AND
		MEMBER_NO =
		#{memberNo}
		ORDER BY QNA_NO DESC
	</select>
	<!-- 문의게시판 게시글 목록 조회(검색) -->
	<select id="selectSearchQnABoardList"
		parameterType="MyPageSearch" resultMap="qna_rm">
		SELECT * FROM
		QNA_LIST
		WHERE QNA_STATUS IN('Y', 'S')
		AND MEMBER_NO =
		#{memberNo}
		<if test="sv != ''">
			AND
			<bind name="val" value="'%' + sv + '%'" />
			<!-- sk에 따라서 조건절을 선택함 -->
			<choose>
				<when test="sk == 'title'">
					QNA_TITLE LIKE #{val}
				</when>
				<when test="sk == 'content'">
					QNA_CONTENT LIKE #{val}
				</when>
			</choose>
			<if test="sc != 0">
				AND QNA_CATEGORY_NO = ${sc}
			</if>

		</if>
		ORDER BY QNA_NO DESC
	</select>



	<!-- 1:1문의내역 -->
	<!-- 1:1문의내역 수 조회 -->
	<select id="getChatListCount" parameterType="Member"
		resultMap="pg_rm">
		SELECT COUNT(*) CNT FROM
		CHAT_ROOM
		WHERE MEMBER_NO = #{memberNo}
	</select>
	<!-- 1:1문의내역 조회(검색) -->
	<select id="selectSearchChatBoardList" parameterType="MyPageSearch" resultMap="chat_rm">
		SELECT CHAT_NO, A.CHAT_ROOM_NO, CHAT_CONTENT,
		CHAT_CREATE_DT, CHAT_READ_YN,
		(SELECT ATTRACTION_NM FROM CHAT_MANAGER_LIST B WHERE B.CHAT_ROOM_NO =
		A.CHAT_ROOM_NO
		<if test="sv != ''">
			<bind name="val" value="'%' + sv + '%'" />
			AND ATTRACTION_NM LIKE #{val}
		</if>
		) ATTRACTION_NM FROM
		(SELECT MAX(CHAT_NO) AS CHAT_NO, CHAT_ROOM_NO
		FROM CHAT_MESSAGE
		WHERE CHAT_ROOM_NO IN (SELECT DISTINCT CHAT_ROOM_NO FROM CHAT_ROOM
		WHERE MEMBER_NO = #{memberNo})
		GROUP BY CHAT_ROOM_NO) A
		JOIN CHAT_MESSAGE USING(CHAT_NO)
	</select>

	<!-- 1:1문의내역 목록 조회 -->
	<select id="selectChatBoardList" parameterType="Member" resultMap="chat_rm">
		SELECT CHAT_NO, A.CHAT_ROOM_NO, CHAT_CONTENT,
		CHAT_CREATE_DT, CHAT_READ_YN,
		(SELECT ATTRACTION_NM FROM CHAT_MANAGER_LIST B WHERE B.CHAT_ROOM_NO =
		A.CHAT_ROOM_NO) ATTRACTION_NM FROM
		(SELECT MAX(CHAT_NO) AS CHAT_NO, CHAT_ROOM_NO
		FROM CHAT_MESSAGE
		WHERE CHAT_ROOM_NO IN (SELECT DISTINCT CHAT_ROOM_NO FROM CHAT_ROOM
		WHERE MEMBER_NO = #{memberNo})
		GROUP BY CHAT_ROOM_NO) A
		JOIN CHAT_MESSAGE USING(CHAT_NO)
	</select>
	
	
	<!-- 신고내역 -->
	<!-- 신고내역 게시글 수 조회 -->
	<select id="getReportListCount" parameterType="Member"
		resultMap="pg_rm">
		 SELECT COUNT(*) CNT FROM REPORT
        JOIN REPORT_CATEGORY USING(REPORT_CATEGORY_NO)
        WHERE MEMBER_NO = #{memberNo}
        AND REPORT_STATUS = 'Y'
	</select>
	<!-- 신고내역 게시글 수 조회(검색) -->
	<select id="getSearchReportListCount" parameterType="MyPageSearch"
		resultMap="pg_rm">
		 SELECT COUNT(*) CNT FROM REPORT
        JOIN REPORT_CATEGORY USING(REPORT_CATEGORY_NO)
        WHERE MEMBER_NO = #{memberNo}
        AND REPORT_STATUS = 'Y'
		<if test="sv != ''">
			AND
			<bind name="val" value="'%' + sv + '%'" />
			<!-- sk에 따라서 조건절을 선택함 -->
			<choose>
				<when test="sk == 'title'">
					REPORT_TITLE LIKE #{val}
				</when>
				<when test="sk == 'content'">
					REPORT_CONTENT LIKE #{val}
				</when>
			</choose>
			<if test="sc != 0">
				AND REPORT_CATEGORY_NO = ${sc}
			</if>

		</if>
	</select>

	<!-- 신고내역 게시글 목록 조회 -->
	<select id="selectReportBoardList" parameterType="Member"
		resultMap="report_rm">
		SELECT *FROM REPORT
        JOIN REPORT_CATEGORY USING(REPORT_CATEGORY_NO)
        WHERE MEMBER_NO = #{memberNo}
        AND REPORT_STATUS = 'Y'
        ORDER BY REPORT_NO DESC
	</select>
	<!-- 신고내역 게시글 목록 조회(검색) -->
	<select id="selectSearchReportBoardList"
		parameterType="MyPageSearch" resultMap="report_rm">
		SELECT * FROM REPORT
        JOIN REPORT_CATEGORY USING(REPORT_CATEGORY_NO)
        WHERE MEMBER_NO = #{memberNo}
        AND REPORT_STATUS = 'Y'
		<if test="sv != ''">
			AND
			<bind name="val" value="'%' + sv + '%'" />
			<!-- sk에 따라서 조건절을 선택함 -->
			<choose>
				<when test="sk == 'title'">
					REPORT_TITLE LIKE #{val}
				</when>
				<when test="sk == 'content'">
					REPORT_CONTENT LIKE #{val}
				</when>
			</choose>
			<if test="sc != 0">
				AND REPORT_CATEGORY_NO = ${sc}
			</if>

		</if>
		ORDER BY REPORT_NO DESC
	</select>
	
</mapper>
